# AI Anker Sandbox Service

[Английский](README.md) | Русский

Sandbox Ai Anker - это изолированная среда выполнения, основанную на контейнерах Docker, предоставляя агенту AI безопасным выполнением команды оболочки, работой файла и возможностями автоматизации браузеров.Эта услуга предоставляет интерфейс API через FastAPI, который поддерживает взаимодействие с сервисными услугами.

## Техническая архитектура

Услуги песочницы интегрируют несколько технологий для предоставления операционной среды AI -агента:

`` `
песочница/
App/ # App Home Directory
│ ├ack
│ └ описано
│ │ ├ack
│ │ ├ack
│ └ └мобив Supervisor.py # Интерфейс управления процессами
│ ├ ├мобил/ # Реализация услуг
│ ├ ├мобил схемы/ # модель интерфейса FASTAPI
│ ├ ├моби модели/ # Модель данных
│ ├í000 Core/ # Core Configuration
│ └ack
File File File File File Docker # Docker
├íмобил. Требования.
SuperSord.Conf # Конфигурация супервизора
Recommation Recommation └íмобил. MD #
`` `

## Основные функции

Среда песочницы предоставляет следующие основные функции:

1. ** выполнение команды оболочки **: безопасно выполнять команды оболочки и управление сеансами поддержки
2. ** Операция файла **: прочитать, записать, поиск и эксплуатировать файловую систему
3. ** Среда браузера **:
- Встроенный браузер Google Chrome
- Поддержка протокола Chrome Devtools
- Предоставьте интерфейс удаленной отладки
4. ** VNC удаленный доступ **:
- VNC -сервис удаленного рабочего стола
- Интерфейс WebSocket
5. ** Управление процессами **: Управление различными процессами компонентов через руководителя

## Требования к эксплуатации

- Python 3.9+
- Docker 20.10+

## Конфигурация установки

### Местная среда развития

1. ** Создайте виртуальную среду **:
`` `bash
python -m venv .venv
Источник .venv/Bin/Activate
`` `

2. ** Зависимости установки **:
`` `bash
PIP установка -R TEDS.TXT
`` `


3. ** Запустите сервер разработки **:
`` `bash
uvicorn app.main: app -host 0.0.0.0 -Port 8080 -Reload
`` `

### Docker развертывание

`` `bash
# Построить зеркало
Docker Build -t Anker -Sandbox.

# Запустите контейнер
Docker Run -p 8080: 8080 -p 9222: 9222 -p 5900: 5900 -p 5901: 5901 Anker -Sandbox
`` `

## Описание порта

- ** 8080 **: сервисный порт Fastapi
- ** 9222 **: хромированный порт удаленной отладки
- ** 5900 **: сервисный порт VNC
- ** 5901 **: vnc websocket port

## Инструкции по конфигурации

Служба песочниц поддерживает следующие элементы конфигурации, которые можно установить через переменные среды или `.env` files:

- ** Происхождение **: допустимый список источников CORS, по умолчанию `["*"]`.Может быть установлен в виде запятой или массива JSON.
- ** service_timeout_minutes **: Тайм -аут обслуживания (минуты), по умолчанию не ограничено.После настройки служба автоматически завершится после указанного времени.
- ** log_level **: уровень журнала может быть установлен для отладки, информации, предупреждения, ошибки или критического, по умолчанию в информацию.

Пример `.env` file:
`` `
Origins = http: // localhost: 3000, https: //example.com
Service_timeout_minutes = 60
Log_level = отладка
`` `

## документация интерфейса API

Основной URL: `/API/V1`

### 1. Интерфейсы, связанные с оболочкой

#### выполнить команды оболочки

- ** Интерфейс **: `post/api/v1/shell/exec`
- ** Описание **: выполнять команды в указанном сеансе оболочки
- ** Запросить тело **:

`` json
{
"ID": "session_id", / * Необязательно, если не предоставлен, идентификатор сеанса будет автоматически создан * /
"exec_dir": "/path/to/dir",/ * Необязательно, рабочий каталог для выполнения команды (должен использоваться абсолютный путь) */
"Команда": "ls -la" / * Команда выполнить * /
}
`` `


- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Команда выполнена»,
"данные": {
"session_id": "session_id",
"Команда": "ls -la",
"Статус": "Запуск"
}
}
`` `

#### Просмотреть контент сеанса оболочки

- ** Интерфейс **: `post/api/v1/shell/view`
- ** Описание **: Просмотреть выходной содержимое указанного сеанса оболочки
- ** Запросить тело **:
`` json
{
"id": "session_id" / * Идентификатор сеанса целевого значения * /
}
`` `
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Содержание сеанса успешно получено»,
"данные": {
«Вывод»: «Содержание вывода сеанса»,
"session_id": "session_id",
"Консоль": [
{
"PS1": "user@host: ~/dir $",
"Команда": "ls -la",
"Вывод": "Вывод списка файлов"
}
]
}
}
`` `

#### В ожидании процесса

- ** Интерфейс **: `post/api/v1/shell/wating`
- ** Описание **: дождитесь процесса в указанном сеансе, чтобы завершить
- ** Запросить тело **:
`` json
{
"id": "session_id", / * идентификатор сеанса целевого сеанса * /
«Секунды»: 10 / * Необязательно, время ожидания (секунды) * /
}
`` `
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Процесс завершен, код возврата: 0»,
"данные": {
"session_id": "session_id",
"returnCode": 0,
"Статус": "Завершено"
}
}
`` `

#### Напишите ввод

- ** Интерфейс **: `post/api/v1/shell/write`
- ** Описание **: Ввод записи в процессы в указанном сеансе
- ** Запросить тело **:
`` json
{
"id": "session_id", / * идентификатор сеанса целевого сеанса * /
«Ввод»: «Пример ввода», / * Содержимое написано * /
"Press_Enter": true / * Смоделировать ли нажмите ввод после ввода * /
}
`` `
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Ввод написан»,
"данные": {
"session_id": "session_id",
«Ввод»: «Пример ввода»
}
}
`` `

#### прекратить процесс

- ** Интерфейс **: `post/api/v1/shell/kill`
- ** Описание **: завершает процесс в указанном сеансе
- ** Запросить тело **:
`` json
{
"id": "session_id" / * Идентификатор сеанса целевого значения * /
}
`` `
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Процесс прекращен»,
"данные": {
"session_id": "session_id",
"Статус": "прекращено"
}
}
`` `

### 2. Интерфейс работы файла

#### Читать файлы

- ** Интерфейс **: `post/api/v1/file/read`
- ** Описание **: Прочтите содержимое указанного файла
- ** Запросить тело **:
`` json
{
"Файл": "/path/to/file",/ * Absolute Pail Path */
"start_line": 0, / * Необязательно, стартовая линия (отсчет от 0) * /
"END_LINE": 100, / * Необязательно, конечная линия (не включая строку) * /
«SUDO»: FALSE / * Необязательно, использовать ли разрешение SUDO для чтения * /
}
`` `
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Файл успешно прочитал»,
"данные": {
"Контент": "Содержание файла",
"line_Count": 100,
"Файл ":"/path/to/file "
}
}
`` `

#### Записать в файл

- ** Интерфейс **: `post/api/v1/file/write`
- ** Описание **: Содержимое записи в указанный файл
- ** Запросить тело **:
`` json
{
"Файл": "/path/to/file",/ * Absolute Pail Path */
«Контент»: «Содержимое файла», / * Содержимое должно быть написано * /
«Приложение»: false, / * необязательно, использовать ли режим приложения * /
"Leading_Newline": false, / * Необязательно, добавить новички перед контентом * /
"trailing_newline": false, / * необязательно, добавить новички после контента * /
«SUDO»: FALSE / * Необязательно, использовать ли разрешение SUDO для записи * /
}
`` `
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Файл написан успешно»,
"данные": {
"Файл": "/path/to/file",
"Bytes_Writen": 123
}
}
`` `

#### Заменить содержимое файла

- ** Интерфейс **: `post/api/v1/file/replying`
- ** Описание **: заменить строки в файле
- ** Запросить тело **:
`` json
{
"Файл": "/path/to/file",/ * Absolute Pail Path */
"Old_str": "Оригинальная строка", / * оригинальная строка, чтобы заменить * /
"new_str": "новая строка", / * заменил новую строку * /
"Sudo": false / * Необязательно, использовать ли разрешения SUDO * /
}
`` `
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Замена завершена, заменила 5 случаев»,
"данные": {
"Файл": "/path/to/file",
"Заменил_Count": 5
}
}
`` `

#### Поиск содержимого файла

- ** Интерфейс **: `post/api/v1/file/search
- ** Описание **: Поиск содержимого файла с использованием регулярных выражений
- ** Запросить тело **:
`` json
{
"Файл": "/path/to/file",/ * Absolute Pail Path */
«regex»: «шаблон поиска», / * Регулярный шаблон выражения * /
"Sudo": false / * Необязательно, использовать ли разрешения SUDO * /
}
`` `
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Поиск завершен, найдено 3 совпадения»,
"данные": {
"Файл": "/path/to/file",
"Матчи": [
{
"line_Number": 10,
"Line": "Соответствующий контент линии",
"Матч": "Сопоставленное контент"
}
]
}
}
`` `

#### Найти файлы

- ** Интерфейс **: `post/api/v1/file/find`
- ** Описание **: Найти файлы на основе шаблона имени файла
- ** Запросить тело **:
`` json
{
«Путь»: «/path/to/dir»,/ * Путь каталога к поиску */
"Glob": "*.txt" /*Уэмплекс имени файла (глобусный синтаксис)* /
}
`` `
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Поиск завершен, найдено 5 файлов»,
"данные": {
«Файлы»: [
"/path/to/dir/file1.txt",
"/path/to/dir/file2.txt"
]
}
}
`` `

### 3. Интерфейс управления процессами

#### Получить статус процесса

- ** Интерфейс **: `get/api/v1/supervisor/status`
- ** Описание **: Получить все статус процесса обслуживания
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Статус сервисов успешно получено»,
"данные": [
{
"имя": "хром",
"Статус": "Запуск",
«Описание»: «Пайд 123, время работы 10:30:45»
}
]
}
`` `

#### Stop All Services

- ** Интерфейс **: `post/api/v1/supervisor/stop`
- ** Описание **: Остановите все услуги
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Все службы остановились»,
"данные": {
"Статус": "Остановился"
}
}
`` `

#### Близкий руководитель

- ** Интерфейс **: `post/api/v1/supervisor/weplowding`
- ** Описание **: Закройте только саму службу супервизирования
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Отключение службы супервизора»,
"данные": {
"Статус": "Закрытие"
}
}
`` `

#### перезапустить все услуги

- ** Интерфейс **: `post/api/v1/supervisor/restart`
- ** Описание **: перезагрузить все услуги
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Все службы перезагрузились»,
"данные": {
"Статус": "Перезагружен"
}
}
`` `

#### тайм -аут активации

- ** Интерфейс **: `post/api/v1/supervisor/timeout/activate`
- ** Описание **: сбросить функцию тайм -аута и автоматически закрыть все службы через указанное время
- ** Запросить тело **:
`` json
{
«Протокол»: 60 / * Необязательно, тайм -аут (минуты), если не предоставлен, используйте систему конфигурации по умолчанию * /
}
`` `
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Сброс тайм -аута, все услуги будут закрыты через 60 минут»,
"данные": {
"timeout_minutes": 60,
"Timeout_timestamp": "2023-07-01t12: 34: 56",
"Статус": "timeout_set"
}
}
`` `

#### Extend Timeout

- ** Интерфейс **: `post/api/v1/supervisor/timeout/extend`
- ** Описание **: продлить тайм -аут
- ** Запросить тело **:
`` json
{
«Протокол»: 30 / * Необязательные, расширенные минуты, если не предоставлены, используйте конфигурацию системы по умолчанию * /
}
`` `
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Тайм -аут расширен, все услуги будут закрыты через 90 минут»,
"данные": {
"timeout_minutes": 90,
"Timeout_timestamp": "2023-07-01t14: 04: 56",
"Статус": "timeout_exted"
}
}
`` `

#### Отмена тайм -аут

- ** Интерфейс **: `post/api/v1/supervisor/timeout/cancel`
- ** Описание **: Отмените функцию тайм -аута
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Тайм -аут отменен»,
"данные": {
"Статус": "timeout_cancelled"
}
}
`` `

#### Получите статус тайм -аута

- ** Интерфейс **: `get/api/v1/supervisor/timeout/status`
- ** Описание **: Получите статус функции тайм -аута
- **Ответ**:
`` json
{
«Успех»: правда,
«Сообщение»: «Оставшееся время: 45 минут»,
"данные": {
«Активно»: правда,
"Timeout_timestamp": "2023-07-01t14: 04: 56",
«Оставшиеся_ секунды»: 2700
}
}
`` `

## Конфигурация среды контейнера

Следующая среда встроена в контейнер с песочницей:

- Ubuntu 22.04
- Python 3.10
- Node.js 20.18.0
- Идтиogle Chrome

## Руководство отладки

### Отладка браузера

1. Подключитесь к `Localhost: 5900` - клиент VNC
2. Посетите `http: // localhost: 9222/devtools/inspector.html` в вашем браузере.