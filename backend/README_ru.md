# AI Anker Backend Service

[Английский](README.md) | Русский

AI Anker - это интеллектуальная прокси -система разговора, основанная на API FASTAPI и OpenAI.В этом бэкенде используется архитектура дизайна, управляемой доменом (DDD), которая поддерживает такие функции, как интеллектуальный диалог, операция файла, выполнение команды оболочки и автоматизация браузера.

## Архитектура проекта

Проект принимает архитектуру дизайна, управляемой доменом (DDD) для четкого разделения обязанностей на каждом уровне:

`` `
Бэкэнд/
App/ Приложение/
│ ├ ├мобил домен/ # Доменное слой: содержит основную бизнес -логику
│ │ ├ack Models/ # Определение модели домена
Services │ ├ ├--S/ # Доменные услуги
│ │ ├íмобильный интерфейс/ # внешний сервисный интерфейс
│ └ └мобил Indpts/ # Шаблон Word
Application Shayer: Orchestrate Business Process
│ │ ├acst
│ └acks схемы/ # Определение шаблона данных
│ ├ ├мобиляции/ # # Интерфейс Сэйр: Определить внешний интерфейс системы
API/ API/ API/
Ship
│ ├ ├мобив Инфраструктура/ # Инфраструктура.
│ └ack
File File конфигурации DockerFile # Docker
Script Script Startup Environment Environment Script
Script Script Startup Scipt Environment Scipt Dev.Sh #
├acks Tepend.txt # зависимости проекта
└ack readme.md # Документация проекта
`` `

## Основные функции

1. ** Управление сеансами **: создавать и управлять экземплярами сеанса разговора
2. ** Диалог в реальном времени **: диалог в реальном времени реализуется через серверные события (SSE)
3. ** Инструментальные вызовы **: поддерживает различные вызовы инструментов, включая:
- Автоматизация браузеров (с помощью драматурга)
- Выполнение и просмотр команды оболочки
- Операции чтения и записи файла
- Интеграция веб -поиска
4. ** Среда песочницы **: Используйте контейнеры Docker, чтобы обеспечить изолированную среду выполнения
5.

## Экологические требования

- Python 3.9+
- Docker 20.10+
- Mongodb 4.4+
- Redis 6.0+

## Конфигурация установки

1. ** Создайте виртуальную среду **:
`` `bash
python -m venv .venv
Источник .venv/Bin/Activate
`` `

2. ** Зависимости установки **:
`` `bash
PIP установка -R TEDS.TXT
`` `

3. ** Конфигурация переменной среды **:
Создайте файл `.env` и установите следующие переменные среды:
`` `
# Конфигурация поставщика моделей
Api_key = your_api_key_here # ключ API для OpenAI или других поставщиков моделей
Api_base = https: //api.openai.com/v1 # Основной URL -адрес модели API, который можно заменить на адрес API других поставщиков моделей

# Конфигурация модели
Model_name = gpt-4o # Используемое имя модели
Температура = 0,7 # Параметры температуры модели
Max_tokens = 2000 # Максимальное выходное число токенов для одного запроса модели

# Конфигурация поиска Google
Google_search_api_key = # Ключ API Google Search для функции веб -поиска (необязательно)
Google_Search_Engine_id = # Google Custom Search Engine (необязательно)

# Конфигурация песочницы
Sandbox_Image = Simpleyyt/Anker-Sandbox # Soundbox Environment Docker Image
Sandbox_Name_prefix = Sandbox # ПРЕДУПРЕЖДЕНИЕ ИМЕНИ ПАНДБОК
Sandbox_ttl_minutes = 30 # Время выживания контейнера из песочницы (минуты)
Sandbox_network = Anker-Network # Docker Network, используемое для связи между контейнерами из песочницы

# Конфигурация базы данных
Mongodb_url = mongodb: // localhost: 27017 # URL соединения mongodb
Mongodb_database = anker # имя базы данных Mongodb
Redis_url = redis: // localhost: 6379/0 # redis connection Url

# Конфигурация журнала
Log_level = info # Уровень журнала, необязательно: отладка, информация, предупреждение, ошибка, критическая
`` `

## Запуск метода

### Среда развития
`` `bash
# Запустить сервер разработки (с функцией горячей перезагрузки)
uvicorn app.main: app -host 0.0.0.0 -Port 8000 -Reload
`` `

Сервис будет запущен по адресу http: // localhost: 8000.

### Docker развертывание
`` `bash
# Построить изображение Docker
Docker Build -t Anker-Ai-Agent.

# Запустите контейнер
Docker Run -p 8000: 8000-env-file .env -v /var/run/docker.sock:/var/run/docker.sock anker-ai-agent
`` `

> Примечание. При развертывании с использованием Docker вам нужно установить розетки Docker, чтобы бэкэнд мог создавать контейнеры из песочницы.

## документация интерфейса API

Основной URL: `/API/V1`

### 1. Создать сеанс

- ** Интерфейс **: `put/api/v1/sessions`
- ** Описание **: Создать новую сеанс разговора
- ** Запросить тело **: нет
- **Ответ**:
`` json
{
"Код": 0,
"MSG": "успех",
"данные": {
"session_id": "строка"
}
}
`` `

### 2. Получить информацию о сеансе

- ** Интерфейс **: `get/api/v1/sessions/{session_id}`
- ** Описание **: Получить информацию о сеансе, включая историю разговоров
- ** Параметры пути **:
- `session_id`: идентификатор сеанса
- **Ответ**:
`` json
{
"Код": 0,
"MSG": "успех",
"данные": {
"session_id": "String",
«Название»: «Строка»,
"события": []
}
}
`` `

### 3. Получите список всех сессий

- ** Интерфейс **: `get/api/v1/sessions`
- ** Описание **: Получите список всех сессий
- **Ответ**:
`` json
{
"Код": 0,
"MSG": "успех",
"данные": {
"Сессии": [
{
"session_id": "String",
«Название»: «Строка»,
"Последний_мессаж": "строка",
"Последняя_Мессадж_ат": 1234567890,
"Статус": "строка",
"Undude_message_count": 0
}
]
}
}
`` `

### 4. Удалить сеанс

- ** Интерфейс **: `delete/api/v1/sessions/{session_id}`
- ** Описание **: Удалить указанный сеанс
- ** Параметры пути **:
- `session_id`: идентификатор сеанса
- **Ответ**:
`` json
{
"Код": 0,
"MSG": "успех",
«Данные»: NULL
}
`` `

### 5. Остановите разговор

- ** Интерфейс **: `post/api/v1/sessions/{session_id}/stop`
- ** Описание **: остановить активные сеансы
- ** Параметры пути **:
- `session_id`: идентификатор сеанса
- **Ответ**:
`` json
{
"Код": 0,
"MSG": "успех",
«Данные»: NULL
}
`` `

### 6. Поговорите с разговором

- ** Интерфейс **: `post/api/v1/sessions/{session_id}/cat
- ** Описание **: отправлять сообщения в сеанс и получить потоковые ответы
- ** Параметры пути **:
- `session_id`: идентификатор сеанса
- ** Запросить тело **:
`` json
{
"Сообщение": "Содержание сообщений пользователя",
«TimeStamp»: 1234567890,
"Event_id": "Необязательный идентификатор события"
}
`` `
- ** Ответ **: Поток серверов-событий (SSE)
- ** Тип события **:
- `message`: текстовое сообщение от помощника
- `title`: обновление заголовка сеанса
- `plan`: выполнить планы и шаги- `step`: обновление статуса шага
- `Tool ': Информация о вызове инструментов
- `error`: сообщение об ошибке
- `dode`: разговор завершен

### 7. Просмотреть контент сеанса оболочки

- ** Интерфейс **: `post/api/v1/sessions/{session_id}/shell`
- ** Описание **: Просмотреть вывод сеанса оболочки в среде песочницы
- ** Параметры пути **:
- `session_id`: идентификатор сеанса
- ** Запросить тело **:
`` json
{
"session_id": "идентификатор сеанса оболочки"
}
`` `
- **Ответ**:
`` json
{
"Код": 0,
"MSG": "успех",
"данные": {
«Вывод»: «Выходное содержание оболочки»,
"session_id": "идентификатор сеанса оболочки",
"Консоль": [
{
"ps1": "Приглашенная строка",
"Команда": "выполнить команду",
"Вывод": "Вывод команды"
}
]
}
}
`` `

### 8. Просмотреть содержимое файла

- ** Интерфейс **: `post/api/v1/sessions/{session_id}/file`
- ** Описание **: Просмотреть содержимое файла в среде песочницы
- ** Параметры пути **:
- `session_id`: идентификатор сеанса
- ** Запросить тело **:
`` json
{
"Файл": "Путь файла"
}
`` `
- **Ответ**:
`` json
{
"Код": 0,
"MSG": "успех",
"данные": {
"Контент": "Содержание файла",
"Файл": "Путь файла"
}
}
`` `

### 9. VNC Connection

- ** Интерфейс **: `websocket/api/v1/sessions/{session_id}/vnc`
- ** Описание **: Создание подключения к VNC WebSocket в среде песочницы сеанса
- ** Параметры пути **:
- `session_id`: идентификатор сеанса
- ** Протокол **: WebSocket (двоичный режим)
- ** Суб Соглашение **: `Бинарный

## обработка ошибок

Все API вернет единый ответ формата, когда возникает ошибка:
`` json
{
"Код": 400,
"MSG": "Описание ошибки",
«Данные»: NULL
}
`` `

Общие коды ошибок:
- `400`: ошибка в параметрах запроса
- `404`: ресурса не существует
- `500`: внутренняя ошибка сервера

## Руководство по разработке

### Добавить новые инструменты

1. Определить интерфейс инструмента в каталоге `домен/внешний
2. Реализация функций инструментов в слое `инфраструктуры
3. Интегрировать инструменты в `Приложение/Сервисы